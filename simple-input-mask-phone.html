<!-- ... Existing code ... -->

<script>
  // Initialize intl-tel-input on the phone input field with preferred countries
  const input = document.querySelector("#phone");
  const iti = window.intlTelInput(input, {
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/utils.js",
    preferredCountries: ["ae", "qa", "om"]
  });

  // Get the error message element
  const phoneError = document.getElementById('phone-error');

  // Helper function to validate and show error for phone field
  function validatePhone() {
    if (iti.isValidNumber()) {
      phoneError.textContent = '';
      input.classList.remove('error');
    } else {
      phoneError.textContent = 'Invalid phone number';
      input.classList.add('error');
    }
  }

  // Trigger validation when the user leaves focus from the phone input field
  input.addEventListener('blur', validatePhone);

  // Input mask for preferred countries
  input.addEventListener('input', function() {
    console.log('Input event triggered');
    const selectedCountry = iti.getSelectedCountryData();
    if (["ae", "qa", "om"].includes(selectedCountry.iso2)) {
      const value = input.value;
      const maskedValue = applyInputMask(selectedCountry.iso2, value);
      console.log(`Original value: ${value}, Masked value: ${maskedValue}`);
      if (value !== maskedValue) {
        input.value = maskedValue;
      }
    }
  });

  // Apply input mask based on country ISO2
  function applyInputMask(countryIso2, value) {
    console.log('Applying input mask');
    if (countryIso2 === "ae") {
      return applyUAEInputMask(value);
    } else if (countryIso2 === "qa" || countryIso2 === "om") {
      return applyQatarOmanInputMask(value);
    }
    return value;
  }

  // ... Rest of the code ...

</script>

<!-- ... Rest of the HTML ... -->
