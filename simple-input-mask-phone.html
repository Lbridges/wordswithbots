<!DOCTYPE html>
<html>
<head>
  <!-- Include the intlTelInput library CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/css/intlTelInput.min.css">
</head>
<body>

<form id="existing-form">
  <label for="name">Name:</label>
  <input type="text" id="name" required>

  <label for="email">Email:</label>
  <input type="email" id="email" required>
  <div id="email-error" style="color: red;"></div>

  <label for="phone">Phone:</label>
  <input type="tel" id="phone" placeholder="">
  <div id="phone-error" style="color: red;"></div>

  <button type="submit">Submit</button>
</form>

<!-- Include the intlTelInput library script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/intlTelInput.min.js"></script>
<script>
  const input = document.querySelector("#phone");
  const iti = window.intlTelInput(input, {
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.2.1/js/utils.js",
    preferredCountries: ["ae", "qa", "om"]
  });

  const phoneError = document.getElementById('phone-error');
  const emailError = document.getElementById('email-error');

  function validatePhone() {
    if (iti.isValidNumber()) {
      phoneError.textContent = '';
      input.classList.remove('error');
    } else {
      phoneError.textContent = 'Invalid phone number';
      input.classList.add('error');
    }
  }

  function validateEmail() {
  const emailInput = document.getElementById('email');
  const emailValue = emailInput.value;
  const emailRegex = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i;

  if (!emailRegex.test(emailValue)) {
    emailError.textContent = 'Invalid email address';
  } else {
    emailError.textContent = '';
  }
}


  input.addEventListener('blur', validatePhone);
  input.addEventListener('input', function() {
    const selectedCountry = iti.getSelectedCountryData();
    if (["ae", "qa", "om"].includes(selectedCountry.iso2)) {
      const value = input.value;
      const maskedValue = applyInputMask(selectedCountry.iso2, value);
      if (value !== maskedValue) {
        input.value = maskedValue;
      }
    }
  });

  function applyInputMask(countryIso2, value) {
    // Input mask logic for preferred countries
    if (["ae", "qa", "om"].includes(countryIso2)) {
      // Apply input mask for qatar and oman
      return value.replace(/\D/g, '').replace(/(\d{4})(\d{4})/, '$1 $2').substr(0, 9);
    }
    return value; // Return the masked value
  }

  document.querySelector("#existing-form").addEventListener('submit', function(event) {
    validatePhone();
    validateEmail();

    if (!iti.isValidNumber() || !document.getElementById('email').checkValidity()) {
      event.preventDefault();
    }
  });

</script>

</body>
</html>
