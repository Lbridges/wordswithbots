<!DOCTYPE html>
<html>
<head>
  <script>
    // Function to validate an email address
    function validateEmail(emailInput) {
      const email = emailInput.value;
      const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
      const errorElement = emailInput.nextElementSibling;

      if (emailPattern.test(email)) {
        emailInput.classList.remove('error');
        errorElement.textContent = '';
        return true;
      } else {
        emailInput.classList.add('error');
        errorElement.textContent = 'Invalid email format';
        return false;
      }
    }

    // Function to dynamically load the libphonenumber-js library
    function loadPhoneNumberLibrary() {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/libphonenumber-js/bundle/libphonenumber-js.min.js';
      document.head.appendChild(script);

      script.onload = function() {
        initPhoneNumberInput();
      };
    }

    // Initialize intl-tel-input on the phone input field
    function initPhoneNumberInput() {
      const phoneInput = document.getElementById('phoneInput');
      const iti = window.intlTelInput(phoneInput, {
        utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/js/utils.js'
      });

      // Event listener for input changes
      phoneInput.addEventListener('input', function () {
        const rawNumber = phoneInput.value.replace(/\D/g, ''); // Remove non-digit characters
        const formattedNumber = iti.formatNumber(rawNumber);
        phoneInput.value = formattedNumber;
      });
    }

    // Add event listeners for email and phone validation
    document.addEventListener('focusout', function(event) {
      const target = event.target;
      if (target.matches('#emailInput')) {
        validateEmail(target);
      }
    });

    document.addEventListener('click', function(event) {
      const target = event.target;
      if (target.matches('#phoneInput')) {
        if (!document.querySelector('script[src*="libphonenumber-js"]')) {
          loadPhoneNumberLibrary();
        }
      }
    });
  </script>
  <style>
    .error {
      border-color: red;
    }
    .error-message {
      color: red;
    }
  </style>
</head>
<body>

<form>
  <label for="emailInput">Email:</label>
  <input type="email" id="emailInput" placeholder="Enter your email">
  <p class="error-message"></p>

  <label for="phoneInput">Phone:</label>
  <input type="tel" id="phoneInput" placeholder="Enter your phone number">
  <p class="error-message"></p>

  <button type="button">Submit</button>
</form>

</body>
</html>
