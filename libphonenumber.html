<!-- Include the intlTelInput library script -->
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/js/intlTelInput.min.js"></script>

<script>
  // Function to dynamically load the libphonenumber-js library
  function loadPhoneNumberLibrary() {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/libphonenumber-js/bundle/libphonenumber-js.min.js';
    document.head.appendChild(script);

    script.onload = function() {
      initPhoneNumberInput();
    };
  }

  // Initialize intl-tel-input on the phone input field
  function initPhoneNumberInput() {
    const phoneInput = document.getElementById('phoneInput');
    const iti = window.intlTelInput(phoneInput, {
      utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/js/utils.js'
    });

    // Event listener for input changes
    phoneInput.addEventListener('input', function () {
      const rawNumber = phoneInput.value.replace(/\D/g, ''); // Remove non-digit characters
      const formattedNumber = iti.formatNumber(rawNumber);
      phoneInput.value = formattedNumber;
    });
  }

  // Add event listener for phone input focus
  document.addEventListener('focusin', function(event) {
    const target = event.target;
    if (target.matches('#phoneInput')) {
      if (!document.querySelector('script[src*="libphonenumber-js"]')) {
        loadPhoneNumberLibrary();
      }
    }
  });
</script>
