<!DOCTYPE html>
<html>
<head>
  <!-- Include the intlTelInput library CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/css/intlTelInput.min.css">
  
  <style>
    .error {
      border-color: red;
    }
  </style>
</head>
<body>

<form>
  <label for="phone">Phone:</label>
  <input type="tel" id="phone" placeholder="">
  <div id="phone-error" style="color: red;"></div>
</form>

<!-- Include the intlTelInput library script -->
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/js/intlTelInput.min.js"></script>
<script>
  // Define preferred countries with input masking patterns
  const preferredCountries = [
    { iso2: 'ae', mask: '+971 00 000 0000' }, // United Arab Emirates
    { iso2: 'qa', mask: '+974 0000 0000' },   // Qatar
    { iso2: 'om', mask: '+968 0000 0000' },   // Oman
    { iso2: 'fr', mask: '+33 0 00 00 00 00' }, // France
    { iso2: 'de', mask: '+49 0000 000000' },   // Germany
    { iso2: 'it', mask: '+39 000 000 0000' },  // Italy
    { iso2: 'no', mask: '+47 00 00 00 00' },   // Norway
    { iso2: 'ch', mask: '+41 00 000 00 00' },  // Switzerland
    { iso2: 'gb', mask: '+44 0 0000 000000' }  // Great Britain
  ];

  // Initialize intl-tel-input on the phone input field
  const phoneInput = document.getElementById('phone');
  const iti = window.intlTelInput(phoneInput, {
    utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/js/utils.js'
  });

  // Set preferred countries and input masks
  iti.promise.then(function () {
    const countryList = iti.getCountries();
    preferredCountries.forEach(prefCountry => {
      const countryData = countryList.find(country => country.iso2 === prefCountry.iso2);
      if (countryData) {
        countryData.mask = prefCountry.mask;
      }
    });
    iti.setCountries(countryList);
  });

  // Helper function to validate and show error for phone field
  function validatePhone() {
    const isValid = iti.isValidNumber();
    if (!isValid) {
      const error = iti.getValidationError();
      const errorMessage = getErrorMessage(error);
      document.getElementById('phone-error').textContent = errorMessage;
      phoneInput.classList.add('error');
    } else {
      document.getElementById('phone-error').textContent = '';
      phoneInput.classList.remove('error');
    }
  }

  // Listen for the "input" event to update the phone validation
  phoneInput.addEventListener('input', validatePhone);

  // Validate phone field onBlur and when clicking elsewhere on the page
  document.addEventListener('click', function (event) {
    const isPhoneInput = event.target === phoneInput || phoneInput.contains(event.target);
    if (!isPhoneInput) {
      validatePhone();
    }
  });

  // Helper function to map error codes to user-friendly error messages
  function getErrorMessage(error) {
    switch (error) {
      case window.intlTelInputUtils.validationError.TOO_SHORT:
        return 'Phone number is too short.';
      case window.intlTelInputUtils.validationError.TOO_LONG:
        return 'Phone number is too long.';
      case window.intlTelInputUtils.validationError.NOT_A_NUMBER:
        return 'Invalid characters in the phone number.';
      // Add more cases for other error codes if needed
      default:
        return 'Invalid phone number.';
    }
  }
</script>

</body>
</html>
